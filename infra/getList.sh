#!/bin/bash
# arg1 is CIDR list

for x in $(cat $1); do
    sudo arp-scan $x | tee -a arp-scan.txt
done

sudo nmap -sn -iL $1 -oG nmap-ping.txt -v

cat nmap-ping.txt | grep 'Up' | sort -u >> nmap-ping-sorted.txt
# Combine results
cat nmap-ping-scan-sorted.txt arp-scan.txt >> combined.txt

while read -r line; do
        # Extract the IP address and DNS name (if available) from the line
        ip=$(echo "$line" | grep -Eo '[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+')
        dns=$(echo "$line" | grep -Eo '\([a-zA-Z0-9]+\.[a-zA-Z0-9]+\.[a-zA-Z0-9]+' | cut -d "(" -f 2)

        # If DNS is available, echo it. Otherwise, echo the IP address.
        if [[ -n "$dns" ]]; then
            echo "$dns - $ ip" >> ip-dom-list.txt
        else
            echo "$ip" >> ip-dom-list.txt
        fi
done < combined.txt

cat ip-dom-list.txt | sort -u >> fulltargets.txt

# run common port nmap scan on discovered hosts
# sudo nmap -sS -Pn -oA nmap-common-tcp -iL full-targets.txt
