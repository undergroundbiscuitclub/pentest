#!/bin/bash

if [ $# -lt 4 ]; then
  echo "getPortFromGNMAP.sh -p [PORT] -f [FILE] [-c (for comma separated)]"
  exit 1
fi

comma=false

while getopts ":p:f:hc" opt; do
  case ${opt} in
    h )
      echo "getPortFromGNMAP.sh -p [PORT] -f [FILE] [-c (for comma separated)]
      exit 0
      ;;
    p )
      port=${OPTARG}
      ;;
    f )
      file=${OPTARG}
      ;;
    c )
      comma=true
      ;;
    \? )
      echo "Invalid option: -$OPTARG" 1>&2
      exit 1
      ;;
    : )
      echo "Option -$OPTARG requires an argument" 1>&2
      exit 1
      ;;
  esac
done


if [ "$comma" = false ]
then
  cat $file | grep " $port/open" | cut -d ' ' -f2
else
  cat $file | grep " $port/open" | cut -d ' ' -f2 | tr "\n" "," | sed 's/,$//'
fi
